# BI可视化工具产品需求文档 (PRD)

## 文档概述

**文档版本**: 1.0  
**创建日期**: 2025-12-10  
**项目名称**: BI可视化工具 - 数据智能分析平台  
**目标用户**: 数据分析师、业务人员、系统管理员  
**应用领域**: 车辆网络安全监控、系统运行状态分析

## 1. 产品概述

### 1.1 产品定位
BI可视化工具是一个一站式数据分析和可视化平台，专门针对整车网络安全CSMS（网络安全管理系统）平台设计，帮助用户快速构建专业的商业智能报表。

### 1.2 核心价值
- **统一数据管理**: 集中管理多数据源，确保数据一致性
- **灵活可视化**: 支持多种图表类型和自定义布局
- **智能分析**: 提供数据关联验证和智能推荐
- **易用性**: 拖拽式操作和模板化设计降低使用门槛

### 1.3 目标用户画像
- **数据分析师**: 需要深入分析和自定义报表的专业人员
- **业务管理人员**: 关注关键指标和趋势的业务决策者
- **系统管理员**: 负责数据源管理和系统维护的技术人员

## 2. 功能架构

### 2.1 核心功能模块

#### 2.1.1 数据源管理
- **功能描述**: 连接和管理多种数据源，包括数据库、API接口和文件数据
- **支持的数据源类型**:
  - 车辆安全监控数据源（IoT数据）
  - 网络安全事件数据源（安全日志）
  - 系统运行状态数据源（监控数据）
- **核心功能**:
  - 数据源连接配置
  - 表结构自动识别
  - 连接状态监控
  - 数据源权限管理

#### 2.1.2 指标定义
- **功能描述**: 基于数据源定义业务指标，支持基础计算和自定义公式
- **指标类型**:
  - 基础指标：COUNT、SUM、AVG等基本聚合函数
  - 复合指标：自定义公式计算
  - 时间序列指标：同比、环比分析
- **核心功能**:
  - 指标公式编辑器
  - 字段映射配置
  - 指标分类管理
  - 指标依赖关系检查

#### 2.1.3 维度配置
- **功能描述**: 配置时间、业务、地理等维度，支持层级维度定义
- **维度类型**:
  - 时间维度：年、月、日、小时等时间粒度
  - 业务维度：车辆编号、安全等级、事件类型等
  - 地理维度：区域、位置等地理信息
- **核心功能**:
  - 维度层级配置
  - 维度关联验证
  - 维度智能推荐

#### 2.1.4 数据卡片
- **功能描述**: 创建各种类型的可视化卡片，如KPI、图表、表格等
- **卡片类型**:
  - KPI指标卡：单个关键指标展示
  - 折线图：时间趋势分析
  - 柱状图：分类对比分析
  - 饼图：占比关系分析
  - 数据表格：支持多指标选择的详细数据展示
  - 地图：地理分布分析
- **核心功能**:
  - 模板化快速创建
  - 可视化配置界面（支持动态表单切换）
  - 实时预览功能
  - 数据一致性检查（包含跨表关联验证）
  - 多指标选择支持（表格类型）

#### 2.1.5 报表配置
- **功能描述**: 组合数据卡片创建报表，支持筛选、布局和分享功能
- **报表类型**:
  - 仪表盘：综合性监控面板
  - 分析报表：详细数据分析
  - 统计报表：定期统计数据
- **核心功能**:
  - 拖拽式布局设计
  - 筛选条件配置
  - 自动刷新设置
  - 报表分享权限

### 2.2 技术架构

#### 2.2.1 前端架构
- **技术栈**: HTML5 + CSS3 + JavaScript (原生)
- **架构模式**: 模块化设计，组件化开发
- **核心组件**:
  - DataCardsManager：数据卡片管理核心类
  - DataConfig：统一数据配置管理
  - ModalManager：模态框管理

#### 2.2.2 数据管理
- **数据存储**: 基于dataConfig.js的统一配置管理
- **缓存机制**: 按需加载和缓存优化
- **数据验证**: 跨表关联验证和一致性检查

#### 2.2.3 界面设计
- **响应式设计**: 支持桌面端和移动端访问
- **组件库**: 自定义CSS组件库
- **交互设计**: 拖拽操作、模态框交互、实时预览

## 3. 详细功能规格

### 3.1 数据源管理规格

#### 3.1.1 数据源连接
```javascript
// 数据源配置示例
{
  id: 1,
  name: '车辆安全监控数据源',
  type: 'iot',
  description: '包含车辆安全状态、传感器数据、异常检测等',
  tables: ['vehicle_security_status', 'sensor_data', 'anomaly_detection']
}
```

#### 3.1.2 表结构管理
- 自动识别数据表结构
- 字段类型映射
- 主键和外键关系
- 索引优化建议

### 3.2 指标定义规格

#### 3.2.1 指标类型定义
- **基础指标**: 直接字段聚合
- **复合指标**: 多字段计算
- **时间指标**: 时间序列分析
- **比率指标**: 百分比计算

#### 3.2.2 指标公式语法
```sql
-- 基础聚合
COUNT(field_name)
SUM(field_name)
AVG(field_name)

-- 条件计算
CASE WHEN condition THEN value ELSE other END

-- 时间计算
YEAR(timestamp_field)
MONTH(timestamp_field)
```

### 3.3 维度配置规格

#### 3.3.1 维度层级配置
- 平级维度：无层级关系
- 树形维度：父子层级关系
- 时间维度：年-月-日层级

#### 3.3.2 维度关联规则
- 数据源一致性检查
- 字段类型匹配验证
- 关联关系智能推荐

### 3.4 数据卡片规格

#### 3.4.1 卡片类型配置

**KPI指标卡配置**:
```javascript
{
  type: 'kpi',
  config: {
    format: 'number',      // 数字格式
    comparison: 'previous_period'  // 比较周期
  }
}
```

**图表配置**:
```javascript
{
  type: 'line',
  config: {
    title: '趋势分析',
    xAxisLabel: '时间',
    yAxisLabel: '数值',
    colorScheme: 'blue'
  }
}
```

**表格配置（多指标支持）**:
```javascript
{
  type: 'table',
  metricIds: [1, 2, 3],  // 多指标ID数组
  config: {
    columns: 6,
    pageSize: 10,
    dimensionUsage: 'grouping'  // 维度使用方式：分组/筛选/不使用
  }
}
```

### 3.5 报表配置规格

#### 3.5.1 布局系统
- 网格布局：固定行列数
- 自由布局：拖拽定位
- 响应式布局：自适应屏幕尺寸

#### 3.5.2 筛选条件
- 时间范围筛选
- 维度值筛选
- 指标阈值筛选
- 组合条件筛选

## 4. 数据模型

### 4.1 核心数据实体

#### 4.1.1 数据源 (DataSource)
```javascript
{
  id: Number,           // 唯一标识
  name: String,         // 数据源名称
  type: String,         // 数据类型
  description: String,  // 描述信息
  tables: Array,        // 包含的表
  connectionConfig: Object  // 连接配置
}
```

#### 4.1.2 指标 (Metric)
```javascript
{
  id: Number,           // 唯一标识
  name: String,         // 指标名称
  displayName: String,  // 显示名称
  dataSourceId: Number, // 关联数据源
  calculationType: String, // 计算类型
  formula: String,      // 计算公式
  description: String   // 描述信息
}
```

#### 4.1.3 维度 (Dimension)
```javascript
{
  id: Number,           // 唯一标识
  name: String,         // 维度名称
  displayName: String,  // 显示名称
  type: String,         // 维度类型
  dataSourceId: Number, // 关联数据源
  field: String,        // 关联字段
  hierarchyType: String // 层级类型
}
```

#### 4.1.4 数据卡片 (DataCard)
```javascript
{
  id: Number,           // 唯一标识
  name: String,         // 卡片名称
  type: String,         // 卡片类型
  metricId: Number,     // 关联指标（单指标类型使用）
  metricIds: Array,     // 关联指标数组（表格类型使用）
  dimensionId: Number,  // 关联维度
  config: Object,       // 配置信息
  description: String   // 描述信息
}
```

#### 4.1.5 报表 (Report)
```javascript
{
  id: Number,           // 唯一标识
  name: String,         // 报表名称
  type: String,         // 报表类型
  dataCardIds: Array,   // 包含的数据卡片
  config: Object,       // 报表配置
  description: String   // 描述信息
}
```

### 4.2 数据关系模型

```
DataSource (1) --- (N) Metric
DataSource (1) --- (N) Dimension
Metric (1) --- (N) DataCard
Dimension (1) --- (N) DataCard
DataCard (N) --- (N) Report
```

## 5. 用户界面设计

### 5.1 页面布局结构

#### 5.1.1 整体布局
```
┌─────────────────────────────────────────────────────────┐
│                    Header (页面标题和操作)                │
├─────────────┬───────────────────────────────────────────┤
│   Sidebar   │              Main Content                 │
│ (导航菜单)   │            (主内容区域)                   │
│             │                                           │
│             │                                           │
│             │                                           │
└─────────────┴───────────────────────────────────────────┘
```

#### 5.1.2 侧边栏导航
- 数据源管理 🗄️
- 指标定义 🎯
- 维度配置 📏
- 数据卡片 📊
- 报表配置 📋

### 5.2 交互设计原则

#### 5.2.1 一致性原则
- 统一的配色方案和视觉风格
- 一致的交互模式和反馈机制
- 标准化的组件库和图标系统

#### 5.2.2 易用性原则
- 直观的操作流程
- 清晰的视觉层次
- 及时的操作反馈
- 智能的默认配置

#### 5.2.3 效率原则
- 快捷键支持
- 批量操作功能
- 模板化快速创建
- 智能推荐和自动完成

## 6. 技术实现方案

### 6.1 前端技术选型

#### 6.1.1 核心框架
- **HTML5**: 语义化标签和现代Web标准
- **CSS3**: 响应式布局和动画效果
- **原生JavaScript**: 轻量级，无框架依赖

#### 6.1.2 架构模式
- **模块化设计**: 功能模块独立封装
- **事件驱动**: 基于自定义事件的通信机制
- **数据绑定**: 手动数据绑定和状态管理

### 6.2 数据管理方案

#### 6.2.1 数据配置管理
```javascript
// 统一数据配置管理类
class DataConfig {
  // 数据加载状态管理
  // 缓存机制实现
  // 按需加载优化
  // 数据一致性验证
}
```

#### 6.2.2 组件通信机制
- 自定义事件系统
- 发布-订阅模式
- 组件间数据传递
- 模态框事件管理（支持动态绑定和重新绑定）

### 6.3 性能优化策略

#### 6.3.1 加载优化
- 按需加载数据配置
- 图片和资源懒加载
- 代码分割和缓存

#### 6.3.2 渲染优化
- 虚拟滚动技术
- 图表数据聚合
- 防抖和节流处理

#### 6.3.3 内存优化
- 对象池技术
- 事件监听器管理
- 定时器清理机制

## 7. 安全性和权限管理

### 7.1 数据安全

#### 7.1.1 数据访问控制
- 数据源连接权限管理
- 指标和维度访问控制
- 报表查看和编辑权限

#### 7.1.2 数据加密
- 敏感数据加密存储
- 传输数据加密
- 密钥管理机制

### 7.2 操作安全

#### 7.2.1 操作审计
- 用户操作日志记录
- 数据变更追踪
- 异常操作告警

#### 7.2.2 权限管理
- 角色权限分配
- 功能模块权限控制
- 数据范围权限限制

## 8. 部署和运维

### 8.1 部署架构

#### 8.1.1 单机部署
- 静态文件部署
- 本地数据存储
- 简单配置管理

#### 8.1.2 分布式部署
- 负载均衡配置
- 数据分片存储
- 高可用架构

### 8.2 监控和运维

#### 8.2.1 系统监控
- 性能指标监控
- 错误日志收集
- 用户行为分析

#### 8.2.2 运维工具
- 配置管理工具
- 数据备份恢复
- 版本升级管理

## 9. 项目里程碑

### 9.1 第一阶段：基础功能 (4周)
- ✅ 数据源管理模块
- ✅ 指标定义模块
- ✅ 维度配置模块
- ✅ 基础数据卡片功能

### 9.2 第二阶段：可视化增强 (3周)
- ✅ 多种图表类型支持
- ✅ 数据卡片模板库
- ✅ 实时预览功能
- ✅ 数据一致性检查

### 9.3 第三阶段：报表系统 (3周)
- ✅ 报表配置模块
- ✅ 拖拽布局系统
- ✅ 筛选条件配置
- ✅ 报表分享功能

### 9.4 第四阶段：优化完善 (2周)
- ✅ 性能优化
- ✅ 用户体验优化
- ✅ 文档完善
- ✅ 测试验收

## 10. 风险评估和应对策略

### 10.1 技术风险

#### 10.1.1 数据兼容性问题
- **风险**: 不同数据源格式不兼容
- **应对**: 标准化数据接口，提供数据转换工具

#### 10.1.2 性能瓶颈问题
- **风险**: 大数据量下性能下降
- **应对**: 数据分页加载，查询优化，缓存机制

### 10.2 业务风险

#### 10.2.1 用户接受度问题
- **风险**: 功能复杂，用户学习成本高
- **应对**: 提供模板和向导，简化操作流程

#### 10.2.2 需求变更风险
- **风险**: 业务需求频繁变更
- **应对**: 模块化设计，扩展性考虑，敏捷开发

## 11. 成功指标

### 11.1 技术指标
- 系统响应时间 < 2秒
- 页面加载时间 < 3秒
- 数据查询成功率 > 99%
- 系统可用性 > 99.5%

### 11.2 业务指标
- 用户活跃度 > 70%
- 功能使用率 > 80%
- 用户满意度 > 4.5/5
- 报表创建效率提升 > 50%

## 12. 附录

### 12.1 术语表

| 术语 | 解释 |
|------|------|
| BI | 商业智能 (Business Intelligence) |
| CSMS | 网络安全管理系统 (Cybersecurity Management System) |
| KPI | 关键绩效指标 (Key Performance Indicator) |
| IoT | 物联网 (Internet of Things) |
| 维度 | 数据分析的角度或分类标准 |
| 指标 | 可量化的业务度量标准 |

### 12.2 参考资料
- 项目代码仓库结构
- 数据配置文件规范
- 用户操作手册
- 技术架构文档

---

**文档维护记录**

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| 1.0 | 2025-12-10 | 初始版本创建 | 张勇劼 |